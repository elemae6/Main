# 교착상태(데드락)   
#### 교착상태란?   
- 프로세스의 집합에 있는 각각의 프로세스가 그 집합에 있는 또다른 프로세스만이 일으킬 수 있는 사건을 기다리는 상황
- 기다리는 쓰레드(혹은 프로세스)가 상태를 절대 안 바꾸는 상황
- 요청한 자원이 다른 대기하는 쓰레드(혹은 프로세스)에 의해 잡혀있기 때문이다.

#### 교착상태가 발생할 필수적인 조건   
- 상호 배제 : 적어도 한 자원이 공유가 불가능한 상태
- 점유와 대기 : 적어도 쓰레드 중 한개가 자원을 하나 잡고 있고, 다른 쓰레드에 의해 잡혀 있는 자원을 기다리는 상태
- 비선점 : 자원이 선점이 불가하다
- 순환 대기 : 대기하는 쓰레드 집합의 의존 그래프가 순환적이다. (자원 할당 그래프가 순확적이다)
  - 자원 할당 그래프가 순환적이지 않으면 데드락은 발생하지 않는다.
  - 자원 할당 그래프가 순환적이면 데드락은 발생할 수도 있고, 발생 안할 수도 있다.

#### 교착상태 다루는 방법   
- 교착상태를 다루는 세가지 방법
  - 그냥 무시한다 (어차피 일년에 두 세번정도 적게 일어나기 때문에)
  - 프로토콜을 사용하여 예방하거나 회피한다
  - 발생하게 내버려둔 후, 발견하면 예방한다.

#### 교착상태 예방 방법   
- 상호 배제 방지 : 일반적으로 적용 불가. mutex lock 같은 경우는 여러개의 쓰레드로부터 공유되면 안된다. 
- 점유와 대기 : 쓰레드가 자원을 요청하려면 가지고 있는 자원을 다 내려놓는 방법인데 비현실적이다.
- 비선점 : 일반적으로 적용 불가. 선점당한 쓰레드가 문제를 일으킬 수 있다.
- 순환 대기 방지 : 때때로 타당하다. 하지만 안될 때도 있다.
  => 결국 예방하지말고, 뱅커 알고리즘으로 피해버리자.
  
#### 교착상태 회피
- 멀티쓰레딩에서 얻은 장점을 교착상태 예방의 부작용이 다 까먹는다.
- 그래서 교착상태가 발생할 것 같으면 대기시켜서 피한다.
- 안전 상태 : 교착상태를 피할 수 있는 특정 쓰레드의 순서가 있는 상태
- single instance의 경우 : claim edge로 인해 RAG(자원 할당 그래프)가 순환이 되는지 안되는지 확인
- multi instance의 경우 : Banker's Algotirhm(은행원 알고리즘)을 이용하여 확인
=> 교착상태가 걸리면 안되거나 아주 비싼 시스템 아니면 굳이 교착상태를 회피할 필요없다.

#### 교착상태 탐지
- 교착상태가 발생하게 놓아두고, 발생하면 탐지를 해서 교착상태로부터 복구를 시켜준다.
- single instance의 경우 : 주기적으로 wait-for 그래프에 사이클을 확인하는 알고리즘을 돌린다.
- multi instance의 경우 : banker's algorithm의 응용 알고리즘을 활용하여 확인한다.
- 실제로 교착상태가 발생하여 문제가 되는 경우는, 1년에 한두번 혹은 4~5년에 한두번이다.
- 만약에 1년에 한 번 발생할 것 같으면, 한달에 한번이나 하루에 한번 교착상태를 탐지하여 밤 12시에 잠깐 점검하는 형식으로 할 수 있다.
- 그래서 교착상태가 탐지되면 알람을 울리게 한 후 컴퓨터를 껐다키면 된다.
- 하지만, 비싼 시스템의 경우, 복구도 해야 한다. 교착상태와 관련된 프로세스를 모두 정지시키거나, 아니면 한 두 프로세스만 정지시킨다.
